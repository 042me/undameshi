/*
  出現率を上げたいものを多めに入れる
  21〜24.png：3倍
  25〜30.png：1倍
*/
const omikujiPics = [
  // 高確率ゾーン
  "21.png","21.png","21.png",
  "22.png","22.png","22.png",
  "23.png","23.png","23.png",
  "24.png","24.png","24.png",

  // 通常確率ゾーン
  "25.png",
  "26.png",
  "27.png",
  "28.png",
  "29.png",
  "30.png"
];

let isOmikuji = false;

const img = document.getElementById("card-image");
const sound = document.getElementById("clickSound");

function changeImageWithFade(src) {
  // いったん透明に戻す（毎回フェードさせるため）
  img.classList.remove("visible");
  img.style.opacity = "0";

  // 読み込み完了後にフェードイン
  img.onload = () => {
    requestAnimationFrame(() => {
      img.classList.add("visible");
    });
  };

  // 画像切り替え
  img.src = src;
}

// 初期表示（20.png）もフェードインさせる
window.addEventListener("load", () => {
  changeImageWithFade("20.png");
});

img.addEventListener("click", () => {
  // 効果音（ユーザー操作内なので再生しやすい）
  if (sound) {
    sound.currentTime = 0;
    sound.play().catch(() => {});
  }

  if (!isOmikuji) {
    const idx = Math.floor(Math.random() * omikujiPics.length);
    changeImageWithFade(omikujiPics[idx]);
    isOmikuji = true;
  } else {
    changeImageWithFade("20.png");
    isOmikuji = false;
  }
});
